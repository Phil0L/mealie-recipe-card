class MealieDetailCard extends HTMLElement{static getConfigForm(){return{schema:[{name:"mealie_instance",required:!0,selector:{config_entry:{integration:"mealie"}}},{name:"mealie_host",required:!1,selector:{text:{}}},{name:"recipe_id",required:!0,selector:{text:{}}},{name:"todo_list_entity",required:!1,selector:{entity:{domain:"todo"}}},{name:"design",type:"expandable",flatten:!0,icon:"mdi:palette",schema:[{name:"show_description",selector:{boolean:{}}},{name:"show_navigation",selector:{boolean:{}}},{name:"show_scrollbar",selector:{boolean:{}}},{name:"show_open_original",selector:{boolean:{}}},{name:"show_open_mealie",selector:{boolean:{}}}]},{name:"interactions",type:"expandable",flatten:!0,icon:"mdi:gesture-tap",schema:[{name:"tap_action",selector:{ui_action:{default_action:"none"}}},{name:"",type:"optional_actions",flatten:!0,schema:["hold_action","double_tap_action"].map(e=>({name:e,selector:{ui_action:{default_action:"none"}}}))}]},{name:"custom_button",type:"expandable",flatten:!1,icon:"mdi:play-circle-outline",schema:[{name:"icon",required:!1,selector:{icon:{}}},{name:"tap_action",required:!1,selector:{ui_action:{default_action:"none"}}}]}],computeLabel:e=>{switch(e.name){case"mealie_instance":return"Mealie instance";case"mealie_host":return"Mealie host (optional)";case"recipe_id":return"Recipe ID";case"todo_list_entity":return"Todo list entity (optional)";case"show_description":return"Show description";case"show_navigation":return"Show navigation buttons";case"show_scrollbar":return"Show horizontal scrollbar";case"show_open_original":return"Show open original recipe button ";case"show_open_mealie":return"Show open in Mealie button";default:return""}},computeHelper:e=>{switch(e.name){case"mealie_instance":return"The Mealie instance to display recipies from";case"mealie_host":return"The host of the Mealie instance (optional, required for loading images, e.g., http://localhost:9000)";case"recipe_id":return"The UUID of the recipe to display (format: 4256b18c-d25d-4f4f-86fe-6b815c4d1cef)";case"todo_list_entity":return"Optionally specify a todo list entity to add ingredients to when clicking the add to list button";case"show_description":return"Show the recipe description in the title card";case"show_navigation":return"Show next/previous buttons for navigating between instructions";case"show_scrollbar":return"Show scrollbar on instructions (for scrolling on desktop devices)";case"show_open_original":return"Show button to open the original recipe URL in a new tab";case"show_open_mealie":return"Show button to open the recipe in Mealie in a new tab (only if mealie_host is configured)";default:return""}},assertConfig:e=>{e.mealie_instance?e.recipe_id?/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e.recipe_id)||console.warn("Mealie Card: The recipe ID must be a valid UUID"):console.warn("Mealie Card: The recipe ID is required"):console.warn("Mealie Card: The Mealie instance is required")}}}static getStubConfig(){return{mealie_instance:"none",mealie_host:"",recipe_id:"",tap_action:{action:"none"},show_description:!0,show_navigation:!0,show_scrollbar:!0}}shouldUpdate(e){return void 0===this.recipe||this.recipe.id!==this.config.recipe_id||this.skeleton}render(){return this.content||(this.innerHTML=`
        <ha-card class="fit-rows recipe" style="cursor: pointer; overflow: hidden; display: flex; flex-direction: column; width: 100%">
          <h1 class="card-header" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; min-height: 32px;">${this.skeleton?"Rezeptname":this.recipe.name}</h1>
          <div class="card-content" style="padding: 0px; width: 100%; flex-basis: -webkit-fill-available; ${this.config.custom_height?`max-height: calc(${this.config.custom_height} - 48px);`:this.skeleton?"max-height: 152px;":""}"></div>
        </ha-card>
      `,this.content=this.querySelector(".card-content"),this.haCard=this.querySelector("ha-card")),this.recipe||this.skeleton?(this.content.innerHTML=`
        <style id="mealie-card-styles"></style>
        <div class="carousel slider" style="padding: 0px; width: 100%; height: 100%; text-align: center; overflow: hidden;">
          <div class="slides" ${this.config.show_scrollbar?"":'style="scrollbar-width: none; -ms-overflow-style: none;"'}">
            <div class="slide" id="slide-1">
              <div class="slide-content" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; width: 100%; padding: 16px; box-sizing: border-box;">
                <img src="${this._get_image_url()}" alt="${this.skeleton?"Recipe image":this.recipe.name}" style="width: 100%; height: 100px; border-radius: 10px; flex-grow:1; object-fit: cover;">
                ${this.config.show_description?`
                <p style="margin: 0; text-align: start; margin-top: 16px;">${this.skeleton?"Short description of the recipe...":this.recipe.description}</p>
                `:""}
                <div style="display: flex; flex-direction: row; align-items: center; flex-grow: 0; flex-wrap: wrap; gap: 8px; justify-content: center; ${this.config.show_navigation?"margin: 16px 48px 0 48px;":"margin: 16px 0 0 0;"}">
                  ${this.recipe&&this.recipe.original_url&&this.config.show_open_original?`<ha-control-button class="press-button original-link-button">
                    <ha-icon icon="mdi:open-in-new"></ha-icon>
                  </ha-control-button>`:""}
                  ${this.config.mealie_host&&this.recipe.slug&&this.config.show_open_mealie?`<ha-control-button class="press-button mealie-button">
                    <ha-icon icon="mdi:silverware-fork-knife"></ha-icon>
                  </ha-control-button>`:""}
                  <ha-control-button class="press-button next-button start-button" style="min-width: 120px;">Start cooking</ha-control-button>
                  ${this.config.todo_list_entity?`<ha-control-button class="press-button todo-button">
                    <ha-icon icon="mdi:playlist-plus"></ha-icon>
                  </ha-control-button>`:""}
                  ${this.config.custom_button&&this.config.custom_button.icon?`<ha-control-button class="press-button custom-button">
                    <ha-icon icon="${this.config.custom_button.icon}"></ha-icon>
                  </ha-control-button>`:""}
                </div>
              </div>
            </div>
            <div class="slide" id="slide-2">
              <div class="slide-content" style="display: flex; flex-direction: column; align-items: start; height: 100%; width: 100%; padding: 4px 16px 64px 16px; box-sizing: border-box; overflow-y: scroll;">
                <h2 style="margin: 0 0 8px 0; min-height: 32px;">Ingredients:</h2>
                ${this.skeleton?"":this.recipe.ingredients.map(e=>`<p style="margin: 0 0 2px 0;">${e.display}</p>`).join("")}
              </div>
            </div>
            ${this.skeleton?"":this.recipe.instructions.map((e,t)=>`<div class="slide" id="slide-${t+3}">
                <div class="slide-content" style="display: flex; flex-direction: column; align-items: start; height: 100%; width: 100%; padding: 4px 16px 64px 16px; box-sizing: border-box; overflow-y: scroll;">
                  <h2 style="margin: 0 0 8px 0; min-height: 32px;">Step ${t+1}: ${e.title||""}</h2>
                  <p style="margin: 0; text-align: start;">${e.text}</p>
                </div>
              </div>`).join("")}
            <div class="slide" id="slide-${this.skeleton?3:this.recipe.instructions.length+3}" style="font-size: 300%;">
              Enjoy!
            </div>
          </div>
          ${this.config.show_navigation?`
          <ha-control-button class="press-button next-button" style="position: absolute; bottom: 16px; right: 16px;">>></ha-control-button>
          <ha-control-button class="press-button previous-button" style="position: absolute; bottom: 16px; left: 16px; display: none;"><<</ha-control-button>
          `:""}
        </div>
      `,this.querySelector("#mealie-card-styles").innerHTML=`
        .slides {
          display: flex;
          overflow-x: auto;
          scroll-snap-type: x mandatory;
          scroll-behavior: smooth;
          height: 100%;
        }
        .slide {
          scroll-snap-align: start;
          flex-shrink: 0;
          width: 100%;
          height: auto;
          margin-right: 8px;
          border-radius: 10px;
          position: relative;
          display: flex;
          justify-content: center;
          align-items: center;
        }
        .slide.template {
          font-size: 100px;
        }
        .slider-link {
          display: inline-flex;
          width: 1.5rem;
          height: 1.5rem;
          background: white;
          text-decoration: none;
          align-items: center;
          justify-content: center;
          border-radius: 50%;
          margin: 0 0 0.5rem 0;
          position: relative;
        }
        .slider-link:active {
          top: 1px;
        }
        .slider-link:focus {
          background: #000;
        }
      `,this.skeleton||this.apply_event_handlers()):this.recipe_loading?this.content.innerHTML="<p>Lade Rezept...</p>":this.content.innerHTML="<p>Kein Rezept verfügbar.</p>",this.innerHTML}_go_carousel(e){var t=[],i=this.querySelector(".slides").scrollLeft,s=i+this.querySelector(".slides").offsetWidth,n=this.querySelector(".slides").offsetWidth/2;if(this.querySelectorAll(".slide").forEach(function(e){t.push([e.offsetLeft,e.offsetLeft+e.offsetWidth])}),0===i&&"next"===e)this.currentItem=1;else if(s===this.querySelector(".slides").scrollWidth&&"previous"===e)console.log("here"),this.currentItem=t.length-2;else for(var o=i+n,r=0;r<t.length;r++)o>t[r][0]&&o<t[r][1]&&(this.currentItem=r,"next"===e?this.currentItem++:"previous"===e?this.currentItem--:parseInt(e)&&(this.currentItem=parseInt(e)));t[this.currentItem]&&this.querySelector(".slides").scrollTo({left:t[this.currentItem][0],behavior:"smooth"})}apply_event_handlers(){this.querySelector(".recipe").addEventListener("click",e=>{if(null!==this.presstimer&&(clearTimeout(this.presstimer),this.presstimer=null),this.longpress)return this.longpress=!1;1===e.detail&&(this.dbltimer=setTimeout(()=>{this.handleClick(this,this._hass,this.config,!1,!1)},200))}),this.querySelector(".recipe").addEventListener("dblclick",e=>{clearTimeout(this.dbltimer),this.handleClick(this,this._hass,this.config,!1,!0)}),this.querySelector(".recipe").addEventListener("mousedown",e=>{"click"===e.type&&0!==e.button||null===this.presstimer&&(this.presstimer=setTimeout(()=>{this.longpress=!0,this.handleClick(this,this._hass,this.config,!0,!1)},1e3))}),this.querySelector(".recipe").addEventListener("touchstart",e=>{"click"===e.type&&0!==e.button||null===this.presstimer&&(this.presstimer=setTimeout(()=>{this.longpress=!0,this.handleClick(this,this._hass,this.config,!0,!1)},1e3))}),this.querySelector(".recipe").addEventListener("mouseout",e=>{null!==this.presstimer&&(clearTimeout(this.presstimer),this.presstimer=null)}),this.querySelector(".recipe").addEventListener("touchend",e=>{null!==this.presstimer&&(clearTimeout(this.presstimer),this.presstimer=null)}),this.querySelector(".recipe").addEventListener("touchleave",e=>{null!==this.presstimer&&(clearTimeout(this.presstimer),this.presstimer=null)}),this.querySelector(".recipe").addEventListener("touchcancel",e=>{null!==this.presstimer&&(clearTimeout(this.presstimer),this.presstimer=null)}),this.querySelectorAll(".next-button").forEach(e=>{e.addEventListener("click",e=>{this._go_carousel("next"),e.stopPropagation()})}),this.querySelectorAll(".previous-button").forEach(e=>{e.addEventListener("click",e=>{this._go_carousel("previous"),e.stopPropagation()})}),this.querySelectorAll(".slide-link").forEach((e,t)=>{e.addEventListener("click",e=>{this._go_carousel(t),e.stopPropagation()})}),this.querySelectorAll(".next-button").forEach(e=>{e.addEventListener("mousedown",e=>{e.stopPropagation()})}),this.querySelectorAll(".previous-button").forEach(e=>{e.addEventListener("mousedown",e=>{e.stopPropagation()})}),this.querySelectorAll(".slide-link").forEach((e,t)=>{e.addEventListener("mousedown",e=>{e.stopPropagation()})}),this.querySelectorAll(".next-button").forEach(e=>{e.addEventListener("dblclick",e=>{e.stopPropagation()})}),this.querySelectorAll(".previous-button").forEach(e=>{e.addEventListener("dblclick",e=>{e.stopPropagation()})}),this.querySelectorAll(".slide-link").forEach((e,t)=>{e.addEventListener("dblclick",e=>{e.stopPropagation()})}),this.querySelector(".slides").addEventListener("scroll",e=>{for(var t=[],i=this.querySelector(".slides").scrollLeft,s=this.querySelector(".slides").offsetWidth/2,n=(this.querySelectorAll(".slide").forEach(function(e){t.push([e.offsetLeft,e.offsetLeft+e.offsetWidth])}),i+s),o=0;o<t.length;o++)n>t[o][0]&&n<t[o][1]&&(this.currentItem=o);this.currentItem>=t.length-1?this.querySelectorAll(".next-button").forEach(e=>{e.style.display="none"}):this.querySelectorAll(".next-button").forEach(e=>{e.style.display="block"}),this.currentItem<1?this.querySelectorAll(".previous-button").forEach(e=>{e.style.display="none"}):this.querySelectorAll(".previous-button").forEach(e=>{e.style.display="block"})}),this.querySelectorAll(".todo-button").forEach(e=>{e.addEventListener("click",e=>{e.stopPropagation(),this.config.todo_list_entity&&this.recipe&&this.recipe.ingredients&&this.recipe.ingredients.forEach(e=>{this.handleClick(this,this._hass,this.config,!1,!1,{action:"call-service",service:"todo.add_item",service_data:{item:e.display},target:{entity_id:this.config.todo_list_entity}})})})}),this.querySelectorAll(".custom-button").forEach(e=>{e.addEventListener("click",e=>{e.stopPropagation(),this.config.custom_button&&this.config.custom_button.action&&this.handleClick(this,this._hass,this.config,!1,!1,this.config.custom_button.action)})}),this.querySelectorAll(".original-link-button").forEach(e=>{e.addEventListener("click",e=>{e.stopPropagation(),!this.skeleton&&this.recipe&&this.recipe.original_url?window.open(this.recipe.original_url,"_blank"):console.warn("Mealie Detail Card: Original URL not available")})}),this.querySelectorAll(".mealie-button").forEach(e=>{e.addEventListener("click",e=>{e.stopPropagation(),!this.skeleton&&this.config.mealie_host&&this.recipe?window.open(`${this.config.mealie_host||"http://localhost:9000"}/g/home/r/`+this.recipe.slug,"_blank"):console.warn("Mealie Detail Card: Mealie host or recipe not available")})})}set hass(e){console.log("Mealie Detail Card: Setting hass instance"),this._hass=e,this.skeleton?this.render():this.recipe||this.recipe_loading||(this.recipe_loading=!0,this._async_get_recipe(this.config.mealie_instance,this.config.recipe_id).then(e=>{e?(console.log("Mealie Detail Card: Loaded recipe",e),this.recipe_loading=!1,this.recipe=e,this.render()):this.recipe_loading=!1}))}get hass(){return this._hass}setConfig(e){if(!e)throw new Error("Invalid configuration: config is required");if(this.skeleton="none"===e.mealie_instance,this.skeleton)console.log("Mealie Detail Card: Skeleton mode enabled"),this.config=e,this.recipe={id:e.recipe_id,name:"name",rating:4,total_time:"45 min"};else{if(!e.mealie_instance)throw new Error("Invalid configuration: 'mealie_instance' is required");if(!e.recipe_id)throw new Error("Invalid configuration: 'recipe_id' is required");if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e.recipe_id)&&""!==e.recipe_id)throw new Error("Invalid configuration: 'recipe_id' must be a valid UUID (e.g., 4256b18c-d25d-4f4f-86fe-6b815c4d1cef)");this.config=e}}async _async_get_recipe(e,t){if(this.skeleton)console.log("Mealie Detail Card: Skeleton mode enabled, skipping recipe load");else if(this._hass){var i="get_recipe",e={config_entry_id:e,recipe_id:t};try{return(await this._hass.callService("mealie",i,e,{},!0,!0)).response.recipe}catch(e){console.error(`Mealie Detail Card: Failed to call service mealie.${i}:`,e)}}else console.error("Mealie Detail Card: Home Assistant instance not available")}_get_image_url(){return this.skeleton?"http://picsum.photos/id/292/3852/2556":`${this.config.mealie_host||"http://localhost:9000"}/api/media/recipes/${this.config.recipe_id}/images/min-original.webp`}getCardSize(){return 4}getGridOptions(){return{rows:6,columns:24,min_columns:6,min_rows:3}}handleClick(e,t,i,s,n,o=null){if(!o&&n&&i.double_tap_action?(o=i.double_tap_action,console.log("Mealie Detail Card: Double tap action triggered",o)):!o&&s&&i.hold_action?(o=i.hold_action,console.log("Mealie Detail Card: Hold action triggered",o)):o||s||!i.tap_action||(o=i.tap_action,console.log("Mealie Detail Card: Tap action triggered",o)),!(o=o||{action:"more-info"}).confirmation||o.confirmation.exemptions&&o.confirmation.exemptions.some(e=>e.user===t.user.id)||confirm(o.confirmation.text||`Are you sure you want to ${o.action}?`))switch(o.action){case"more-info":(o.entity||i.entity||i.camera_image)&&(this.fireEvent(e,"hass-more-info",{entityId:o.entity||i.entity||i.camera_image}),o.haptic)&&this.forwardHaptic(o.haptic);break;case"navigate":o.navigation_path&&(this.navigate(e,o.navigation_path),o.haptic)&&this.forwardHaptic(o.haptic);break;case"url":o.url_path&&window.open(o.url_path),o.haptic&&this.forwardHaptic(o.haptic);break;case"toggle":i.entity&&(toggleEntity(t,i.entity),o.haptic)&&this.forwardHaptic(o.haptic);break;case"call-service":if(!o.service)return;var[r,a]=o.service.split(".",2),l={...o.service_data};"entity"===l.entity_id&&(l.entity_id=i.entity),t.callService(r,a,l,o.target),o.haptic&&this.forwardHaptic(o.haptic);break;case"perform-action":if(!o.perform_action)return;var[r,a]=o.perform_action.split(".",2),l={...o.data};"entity"===l.entity_id&&(l.entity_id=i.entity),t.callService(r,a,l,o.target),o.haptic&&this.forwardHaptic(o.haptic);break;case"fire-dom-event":this.fireEvent(e,"ll-custom",o),o.haptic&&this.forwardHaptic(o.haptic)}}fireEvent(e,t,i,s){s=s||{},i=null==i?{}:i;t=new Event(t,{bubbles:void 0===s.bubbles||s.bubbles,cancelable:Boolean(s.cancelable),composed:void 0===s.composed||s.composed});return t.detail=i,e.dispatchEvent(t),t}forwardHaptic(e){this.fireEvent(window,"haptic",e)}navigate(e,t,i=!1){i?history.replaceState(null,"",t):history.pushState(null,"",t),this.fireEvent(window,"location-changed",{replace:i})}}customElements.define("mealie-detail-card",MealieDetailCard),window.customCards=window.customCards||[],window.customCards.push({type:"mealie-detail-card",name:"Mealie Detail Card",description:"Zeigt Rezeptanweisungen von Mealie an.",preview:!0}),window.addEventListener("resize",MealieDetailCard.getCarouselPositions);class MealieRecipeCard extends HTMLElement{static getConfigForm(){return{schema:[{name:"mealie_instance",required:!0,selector:{config_entry:{integration:"mealie"}}},{name:"mealie_host",required:!1,selector:{text:{}}},{name:"recipe_id",required:!0,selector:{text:{}}},{name:"design",type:"expandable",flatten:!0,icon:"mdi:palette",schema:[{name:"show_rating",selector:{boolean:{}}},{name:"show_prep_time",selector:{boolean:{}}},{name:"show_tags",selector:{boolean:{}}}]},{name:"interactions",type:"expandable",flatten:!0,icon:"mdi:gesture-tap",schema:[{name:"tap_action",selector:{ui_action:{default_action:"none"}}},{name:"",type:"optional_actions",flatten:!0,schema:["hold_action","double_tap_action"].map(e=>({name:e,selector:{ui_action:{default_action:"none"}}}))}]}],computeLabel:e=>{switch(e.name){case"mealie_instance":return"Mealie instance";case"mealie_host":return"Mealie host (optional)";case"recipe_id":return"Recipe ID";default:return""}},computeHelper:e=>{switch(e.name){case"mealie_instance":return"The Mealie instance to display recipies from";case"mealie_host":return"The host of the Mealie instance (optional, required for loading images, e.g., http://localhost:9000)";case"recipe_id":return"The UUID of the recipe to display (format: 4256b18c-d25d-4f4f-86fe-6b815c4d1cef)";default:return""}},assertConfig:e=>{e.mealie_instance?e.recipe_id?/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e.recipe_id)||console.warn("Mealie Recipe Card: The recipe ID must be a valid UUID"):console.warn("Mealie Recipe Card: The recipe ID is required"):console.warn("Mealie Recipe Card: The Mealie instance is required")}}}static getStubConfig(){return{mealie_instance:"none",mealie_host:"",recipe_id:"",tap_action:{action:"none"},show_prep_time:!0,show_rating:!0,show_tags:!1}}shouldUpdate(e){return void 0===this.recipe||this.recipe.id!==this.config.recipe_id||this.skeleton}render(){return this.content||(this.innerHTML=`
        <ha-card style="cursor: pointer; overflow: hidden;">
          <div class="card-content fit-rows" style="padding: 0px; ${this.config.custom_height?`height: ${this.config.custom_height};`:this.skeleton?"height: 200px;":""}"></div>
        </ha-card>
      `,this.content=this.querySelector(".card-content")),this.recipe||this.skeleton?(this.content.innerHTML=`
        <div class="recipe" id="recipe_${this.config.recipe_id}" style="width: 100%; height: 100%; overflow: hidden; display: flex; flex-direction: column;">
        <div class="image" style="width: 100%; height: -webkit-fill-available; flex-grow: 1; background: url('${this._get_image_url()}') no-repeat center center / cover;"></div>
        <div class="recipe-details" style="padding-left: 0px; padding-right: 0px; padding-bottom: 8px; width: 100%;">
          <h2 slot="primary" class="title" style="margin: 0; font-size: var(--ha-font-size-m); font-weight: var(--ha-font-weight-medium); padding: 0px 16px; margin-top: 8px;">${this.recipe.name}</h2>
          <div class="rating prep-time tags" style="display: flex; align-items: center; gap: 12px; margin-top: 8px; flex-wrap: wrap; padding: 0px 16px;">
            ${this.config.show_rating?`<div class="rating" style="display: flex; gap: 2px;">
              <ha-icon icon="${0<this.recipe.rating?"mdi:star":"mdi:star-outline"}" style="color: var(--accent-color, rgb(151, 53, 66));"></ha-icon>
              <ha-icon icon="${1<this.recipe.rating?"mdi:star":"mdi:star-outline"}" style="color: var(--accent-color, rgb(151, 53, 66));"></ha-icon>
              <ha-icon icon="${2<this.recipe.rating?"mdi:star":"mdi:star-outline"}" style="color: var(--accent-color, rgb(151, 53, 66));"></ha-icon>
              <ha-icon icon="${3<this.recipe.rating?"mdi:star":"mdi:star-outline"}" style="color: var(--accent-color, rgb(151, 53, 66));"></ha-icon>
              <ha-icon icon="${4<this.recipe.rating?"mdi:star":"mdi:star-outline"}" style="color: var(--accent-color, rgb(151, 53, 66));"></ha-icon>
            </div>`:""}
            ${this.recipe.total_time&&this.config.show_prep_time?`<div class="prep-time" style="display: flex; align-items: center; gap: 2px; background-color: rgba(var(--my-color-rgb), 0.1); border-radius: 12px; color: var(--accent-color, rgb(151, 53, 66));">
              <ha-icon icon="mdi:clock-outline" style="font-size: 1em;"></ha-icon>
              <span style="font-size: 0.7em; margin-right: 8px;">${this.recipe.total_time}</span>
            </div>`:""}
            ${this.recipe.tags&&0<this.recipe.tags.length&&this.config.show_tags?`<div class="tags" style="display: flex; gap: 0px; overflow: auto; white-space: nowrap; margin-left: -16px; margin-right: -16px; padding-left: 16px; padding-right: 16px;">
            ${this.recipe.tags.map(e=>`<div style="display: flex; align-items: center; gap: 2px; border-radius: 12px; color: var(--accent-color, rgb(151, 53, 66)); flex-shrink: 0; padding: 0 8px;">
              <ha-icon icon="mdi:tag" style="font-size: 0.8em;"></ha-icon>
              <span style="font-size: 0.7em;">${e.name}</span>
            </div>`).join("")}
            </div>`:""}
          </div>
        </div>
      `,this.skeleton||this.apply_event_handlers()):this.recipe_loading?this.content.innerHTML="<p>Lade Rezept...</p>":this.content.innerHTML="<p>Kein Rezept verfügbar.</p>",this.innerHTML}apply_event_handlers(){this.content.querySelector(".recipe").addEventListener("click",e=>{if(null!==this.presstimer&&(clearTimeout(this.presstimer),this.presstimer=null),this.longpress)return this.longpress=!1;1===e.detail&&(this.dbltimer=setTimeout(()=>{this.handleClick(this,this._hass,this.config,!1,!1)},200))}),this.content.querySelector(".recipe").addEventListener("dblclick",e=>{clearTimeout(this.dbltimer),this.handleClick(this,this._hass,this.config,!1,!0)}),this.content.querySelector(".recipe").addEventListener("mousedown",e=>{"click"===e.type&&0!==e.button||null===this.presstimer&&(this.presstimer=setTimeout(()=>{this.longpress=!0,this.handleClick(this,this._hass,this.config,!0,!1)},1e3))}),this.content.querySelector(".recipe").addEventListener("touchstart",e=>{"click"===e.type&&0!==e.button||null===this.presstimer&&(this.presstimer=setTimeout(()=>{this.longpress=!0,this.handleClick(this,this._hass,this.config,!0,!1)},1e3))}),this.content.querySelector(".recipe").addEventListener("mouseout",e=>{null!==this.presstimer&&(clearTimeout(this.presstimer),this.presstimer=null)}),this.content.querySelector(".recipe").addEventListener("touchend",e=>{null!==this.presstimer&&(clearTimeout(this.presstimer),this.presstimer=null)}),this.content.querySelector(".recipe").addEventListener("touchleave",e=>{null!==this.presstimer&&(clearTimeout(this.presstimer),this.presstimer=null)}),this.content.querySelector(".recipe").addEventListener("touchcancel",e=>{null!==this.presstimer&&(clearTimeout(this.presstimer),this.presstimer=null)})}set hass(e){console.log("Mealie Recipe Card: Setting hass instance"),this._hass=e,this.skeleton?this.render():this.recipe||this.recipe_loading||(this.recipe_loading=!0,this._async_get_recipe(this.config.mealie_instance,this.config.recipe_id).then(e=>{e?(console.log("Mealie Recipe Card: Loaded recipe",e),this.recipe_loading=!1,this.recipe=e,this.render()):this.recipe_loading=!1}))}get hass(){return this._hass}setConfig(e){if(!e)throw new Error("Invalid configuration: config is required");if(this.skeleton="none"===e.mealie_instance,this.skeleton)console.log("Mealie Recipe Card: Skeleton mode enabled"),this.config=e,this.recipe={id:e.recipe_id,name:"name",rating:4,total_time:"45 min"};else{if(!e.mealie_instance)throw new Error("Invalid configuration: 'mealie_instance' is required");if(!e.recipe_id)throw new Error("Invalid configuration: 'recipe_id' is required");if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e.recipe_id)&&""!==e.recipe_id)throw new Error("Invalid configuration: 'recipe_id' must be a valid UUID (e.g., 4256b18c-d25d-4f4f-86fe-6b815c4d1cef)");this.config=e,console.log("Mealie Recipe Card: Configuration set",this.config)}}async _async_get_recipe(e,t){if(this.skeleton)console.log("Mealie Recipe Card: Skeleton mode enabled, skipping recipe load");else if(this._hass){var i="get_recipe",e={config_entry_id:e,recipe_id:t};try{return(await this._hass.callService("mealie",i,e,{},!0,!0)).response.recipe}catch(e){console.error(`Mealie Recipe Card: Failed to call service mealie.${i}:`,e)}}else console.error("Mealie Recipe Card: Home Assistant instance not available")}_get_image_url(){return this.skeleton?"http://picsum.photos/id/292/3852/2556":`${this.config.mealie_host||"http://localhost:9000"}/api/media/recipes/${this.config.recipe_id}/images/min-original.webp`}getCardSize(){return 10}getGridOptions(){return{rows:4,columns:12,min_columns:6,min_rows:3,max_rows:10}}handleClick(e,t,i,s,n,o=null){if(n&&i.double_tap_action?(o=i.double_tap_action,console.log("Mealie Recipe Card: Double tap action triggered",o)):s&&i.hold_action?(o=i.hold_action,console.log("Mealie Recipe Card: Hold action triggered",o)):!s&&i.tap_action&&(o=i.tap_action,console.log("Mealie Recipe Card: Tap action triggered",o)),!(o=o||{action:"more-info"}).confirmation||o.confirmation.exemptions&&o.confirmation.exemptions.some(e=>e.user===t.user.id)||confirm(o.confirmation.text||`Are you sure you want to ${o.action}?`))switch(o.action){case"more-info":(o.entity||i.entity||i.camera_image)&&(this.fireEvent(e,"hass-more-info",{entityId:o.entity||i.entity||i.camera_image}),o.haptic)&&this.forwardHaptic(o.haptic);break;case"navigate":o.navigation_path&&(this.navigate(e,o.navigation_path),o.haptic)&&this.forwardHaptic(o.haptic);break;case"url":o.url_path&&window.open(o.url_path),o.haptic&&this.forwardHaptic(o.haptic);break;case"toggle":i.entity&&(toggleEntity(t,i.entity),o.haptic)&&this.forwardHaptic(o.haptic);break;case"call-service":if(!o.service)return;var[r,a]=o.service.split(".",2),l={...o.service_data};"entity"===l.entity_id&&(l.entity_id=i.entity),t.callService(r,a,l,o.target),o.haptic&&this.forwardHaptic(o.haptic);break;case"perform-action":if(!o.perform_action)return;var[r,a]=o.perform_action.split(".",2),l={...o.data};"entity"===l.entity_id&&(l.entity_id=i.entity),t.callService(r,a,l,o.target),o.haptic&&this.forwardHaptic(o.haptic);break;case"fire-dom-event":this.fireEvent(e,"ll-custom",o),o.haptic&&this.forwardHaptic(o.haptic)}}fireEvent(e,t,i,s){s=s||{},i=null==i?{}:i;t=new Event(t,{bubbles:void 0===s.bubbles||s.bubbles,cancelable:Boolean(s.cancelable),composed:void 0===s.composed||s.composed});return t.detail=i,e.dispatchEvent(t),t}forwardHaptic(e){this.fireEvent(window,"haptic",e)}navigate(e,t,i=!1){i?history.replaceState(null,"",t):history.pushState(null,"",t),this.fireEvent(window,"location-changed",{replace:i})}}customElements.define("mealie-recipe-card",MealieRecipeCard),window.customCards=window.customCards||[],window.customCards.push({type:"mealie-recipe-card",name:"Mealie Recipe Card",description:"Zeigt ein Rezept von Mealie an.",preview:!0});